<project name="Export JavaCook Source" default="dist" basedir=".">

<!-- 
 *** Build the jars for downloading and update the web site.
 *** List of files set in darian:/cvs/CVSROOT/modules line for javacook-src
 *** $Id$
 -->

	<property name="src" value="."/>
	<property name="build" value="build"/>
	<property name="build.work" value="build/javasrc"/>

	<property name="dist.jar" value="javacooksrc2.jar"/>

	<property name="CVSROOT" value="ian@darian:/cvs"/>

	<!-- This init is different; it ensures that build is clean and exists -->
	<target name="init" depends="clean">
		<tstamp/>
		<mkdir dir="${build.work}"/>
	</target>

	<target name="get" depends="init">
		<cvs cvsRoot="${CVSROOT}" command="export" date="now"
			quiet="true"
			package="javacook-src"
			dest="${build}"/>
		<echo message="javasrc.home=${user.dir}/${build.work}" 
			file="${build.work}/build.properties" append="true"/>
	</target>

	<target name="api" depends="get">
		<ant dir="${build.work}/darwinsys" target="dist"
			inheritAll="false"/>
	</target>

	<target name="index" depends="api">
		<!-- Update the index.html for just what we exported -->
		<javac srcdir="${build.work}/netweb" includes="MkIndex.java"/>
		<java classpath="${build.work}/netweb" classname="MkIndex"
			dir="${build.work}" fork="yes"/>
	</target>

	<target name="jar" depends="index">
		<jar jarFile="${dist.jar}" includes="${build.work}/**"/>
	</target>

	<target name="dist" depends="jar"/>

	<target name="deploy" depends="dist">

		<scp file="${dist.jar}" todir="darwinsys.com:/www/javacook/"/>

		<Sshexec 
			host="darwinsys.com"
			command="cd /www/javacook; unzip -fo ${dist.jar}" />
	</target>

	<target name="notify">
		<mail subject="Java Cookbook Download Updated" 
			message=
				"${dist.jar} updated at javacook.darwinsys.com/download.html"
			from="Ian Darwin &lt;http://www.darwinsys.com/&gt;"
			tolist="http://www.darwinsys.com/"
			cclist="http://www.darwinsys.com/"
			/>
	</target>

	<target name="clean">
		<delete dir="${build.work}"/>
		<delete file="${dist.jar}"/>
	</target>
</project>
